# Тестовое задание для Effective Mobile

## Аунтенцификация и авторизация

**Аутентификация**: Пользователь вводит свою почту, в ответе ему приходит jwt token с помощью которого происходит всё дальнейшее взаимодействие.
**Авторизация**: При регистрации пользователю даётся три разрешения: редактирование, добавление и удаление записей (для ознакомления пользователю даётся ещё и роль админа, это можно изменить в config).

## Система ролей и доступ к ресурсам

Всего есть пять ролей:  
**admin** даёт и забирает роли у других пользователей  
**moderator** редактирует и удаляет записи других пользователей  
**edit:** редактирование записи  
**create:** создание записи  
**delete:** удаление записи  

Роли хранятся в Postgres с помощью связи многие к многим и привязываются к пользователю.
При обращении пользователя к какому-либо ресурсу, если требуется, сначала проверяется имеет ли пользователь разрешение,
с помощью SQLAlchemy ORM и связи многие к многим.

## Управление ролями

Для управления ролями реализованы отдельные пути:  
**POST** /api/v1/manage/permission  
**DELETE** /api/v1/manage/permission  

Этими путями может пользоваться только admin.

## Определение пользователя системой

При аунтентификации пользователю выдаётся JWT Token, который заносится в whitelist реализованный с помощью Redis.
И при каждом запросе пользователя проверяется сам токен и его наличие в whitelist.
Так же пользователь может обновить токен пока он не истёк.

## Выход их системы

При logout токен удаляется из whitelist и становится недействительным.
По истечению часа токен становится недействительным и удаляется из whitelist.
Токен хранится не целиком, а его индентификационный ключ.

## Мягкое удаление пользователя

Пользователь не удаляется из бд, а становится лишь неактивным с помощью поля active в таблице User.
При дальнейшем входе в систему пользователю говорится, что он не найден.
Только если он попробует зарегестрироваться заново, получит доступ к своему аккаунту. 

## Технологии

- **Backend**: FastAPI
- **Database**: Postgres, Redis (for whitelist)
- **Containerization**: Docker Compose, Docker File
- **Database queries**: SQL Alchemy
- **Database migrations**: Alembic
- **Data validation**: Pydantic
- **Logs**: Logging
  
## Запуск приложения

### Требования

- Python 3.12.3
- Docker
- Docker Compose
- Ubuntu
  
### Шаги установки

**Клонирование репозитория:**

   ```bash
    git clone https://github.com/samypushisty/TestTaskEM.git
    cd TestTaskEM
  ```
**Переименовать .example_env и redis_example.conf в .env и redis.conf соответственно**

**Запуск контейнера**

   ```bash
     sudo docker compose up --build
   ```

**Connect and use**

    connect to http://0.0.0.0:8000/docs
    
## Важно!
1. Не использовать пробелы в пути к проекту
2. Все команды для Ubuntu
3. Если вы используете виндовс замените UVLoop library на Asyncio(3.4.3) library
